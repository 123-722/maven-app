def gv

pipeline {
    agent any
    
    
    tools{
       maven 'my-mvn'
    }
    
    
    parameters {
    choice(name:'AppVersion',choices[ '1.1','1.2' ,2],description:'')
    booleanParam(name:'runTest',defaultValue: true )
    }
    stages {
        stage("init") {
            steps {
                script {
                    gv = load "script.groovy"
                }
            }
        }
        stage("build jar") {
            steps {
                script {
                    echo "building jar"
                    //gv.buildJar()
                
                }
            }
        }
        stage("build image") {
            steps {
                script {
                    echo "building image"
                    //gv.buildImage()
                }
            }
        }
        stage("Test Stage ") {
           
                when {
                    expression {
                              params.runTest==true
                              }
                     }         
               steps {
                script {
                    echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL}"
                    sh 'sleep 10 '
                    sh ' mvn test '
                }
            }
                
           
               
         
        }
        
        
        stage("deploy") {
            steps {
                script {
                    echo "deploying version ${params.AppVersion}"
                   
                    
                   gv.deployApp()
                }
            }
        }
    } 
     post{
        
        success{
            echo " done done"
        }
        failure{ echo " faileeee" }
        
    }
}
