def gv

pipeline {
    agent any
    
    
    tools{
       maven 'my-mvn'
    }
    
    
    parameters {
    booleanParms(name:'runTest',defaultValue:True,description:' TEST mvn ' )
    }
    stages {
        stage("init") {
            steps {
                script {
                    gv = load "script.groovy"
                }
            }
        }
        stage("build jar") {
            steps {
                script {
                    echo "building jar"
                    //gv.buildJar()
                
                }
            }
        }
        stage("build image") {
            steps {
                script {
                    echo "building image"
                    //gv.buildImage()
                }
            }
        }
        stage("Test Stage ") {
           
                when {
                    expression {
                              params.runTest
                              }
                     }         
                   
                
             steps {
                echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL}"
                sh 'sleep 10 '
                 sh ' mvn test '
            }
        }
        
        
        stage("deploy") {
            steps {
                script {
                    echo "deploying"
                    
                   gv.deployApp()
                }
            }
        }
    } 
     post{
        
        success{
            echo " done done"
        }
        failure{ echo " faileeee" }
        
    }
}
